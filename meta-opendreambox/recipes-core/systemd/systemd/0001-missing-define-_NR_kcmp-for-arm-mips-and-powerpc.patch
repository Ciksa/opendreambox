From 32d053f0cd9ab0fe733f78ec1436f2b24db42305 Mon Sep 17 00:00:00 2001
From: Andreas Oberritter <obi@opendreambox.org>
Date: Fri, 20 Mar 2015 14:06:41 +0100
Subject: [PATCH 1/4] missing: define _NR_kcmp for arm, mips and powerpc

Signed-off-by: Andreas Oberritter <obi@opendreambox.org>
---
 src/shared/missing.h | 20 ++++++++++++++++++++
 1 file changed, 20 insertions(+)

diff --git a/src/shared/missing.h b/src/shared/missing.h
index b33a70c..ff1dd5f 100644
--- a/src/shared/missing.h
+++ b/src/shared/missing.h
@@ -755,6 +755,26 @@ static inline int renameat2(int oldfd, const char *oldname, int newfd, const cha
 #endif
 
 #if !HAVE_DECL_KCMP
+
+#ifndef __NR_kcmp
+#  if defined __arm__
+#    define __NR_kcmp 378
+#  elif defined _MIPS_SIM
+#    if _MIPS_SIM == _MIPS_SIM_ABI32
+#      define __NR_kcmp 4347
+#    elif _MIPS_SIM == _MIPS_SIM_ABI64
+#      define __NR_kcmp 5306
+#    elif _MIPS_SIM == _MIPS_SIM_NABI32
+#      define __NR_kcmp 6311
+#    endif
+#  elif defined __powerpc__
+#    define __NR_kcmp 354
+#  else
+#    warning "__NR_kcmp unknown for your architecture"
+#    define __NR_kcmp 0xffffffff
+#  endif
+#endif
+
 static inline int kcmp(pid_t pid1, pid_t pid2, int type, unsigned long idx1, unsigned long idx2) {
         return syscall(__NR_kcmp, pid1, pid2, type, idx1, idx2);
 }
-- 
1.9.1

