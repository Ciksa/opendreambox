From ffe4a19e762064e99dd73ac035e7b415ea981573 Mon Sep 17 00:00:00 2001
From: reichi <reichi@opendreambox.org>
Date: Thu, 15 Feb 2018 07:46:38 +0100
Subject: [PATCH 3/6] keymap: improve keyboard support (by forum member pclin)

---
 usr/share/enigma2/keymap.xml | 105 +++++++++++++++++++++++++++++++++++++++++++++++++-------
 1 file changed, 92 insertions(+), 13 deletions(-)

diff --git a/usr/share/enigma2/keymap.xml b/usr/share/enigma2/keymap.xml
index ec3e090..2023a84 100644
--- a/usr/share/enigma2/keymap.xml
+++ b/usr/share/enigma2/keymap.xml
@@ -1,4 +1,16 @@
 <keymap>
+    <!--
+    m = make -> Normal key press
+    l = long -> Long key press
+    b = break -> Key released
+    r = repeat -> Key locked (pressed continuously)
+
+    "m" arrives once, as soon as the key is pressed
+    "r" arrives after "m", when the key is pressed continuously until the key is released
+    "l" arrives after 5 repeats, but then only once (repeat still arrives)
+    "b" arrives as soon as the key is released.
+    Flags can be combined, eg. flags="mr"
+    -->
 	<map context="ListboxActions">
 		<device name="keyboard">
 			<key id="a" mapto="up" flags="mr" />
@@ -12,7 +24,6 @@
 		<key id="KEY_PAGEDOWN" mapto="pageDown" flags="mr" />
 		<key id="KEY_LEFT" mapto="pageUp" flags="mr" />
 		<key id="KEY_RIGHT" mapto="pageDown" flags="mr" />
-		
 		<key id="1" mapto="moveUp" flags="mr" />
 		<key id="2" mapto="moveDown" flags="mr" />
 	</map>
@@ -32,6 +43,8 @@
 
 	<map context="SetupActions">
 		<device name="compatible: pcKeyboard">
+			<key id="KEY_ENTER" mapto="ok" flags="m" />
+			<key id="KEY_ESC" mapto="cancel" flags="m" />
 			<key id="KEY_F1" mapto="cancel" flags="m" />
 			<key id="KEY_F2" mapto="save" flags="m" />
 			<key id="KEY_DELETE" mapto="deleteForward" flags="mr" />
@@ -96,6 +109,10 @@
 		<device name="dreambox ir keyboard">
 			<key id="KEY_YELLOW" mapto="showEventList" flags="b" />
 		</device>
+		<device name="compatible: pcKeyboard">
+			<key id="KEY_F3" mapto="showEventList" flags="b" />
+			<key id="KEY_F5" mapto="showEventInfo" flags="b" />
+		</device>
 	</map>
 	
 	<map context="InfobarInstantRecord">
@@ -110,7 +127,7 @@
 			<key id="KEY_RED" mapto="instantRecord" flags="b" />
 		</device>
 		<device name="compatible: pcKeyboard">
-			<key id="KEY_F1" mapto="instantRecord" flags="b" />
+			<key id="KEY_F12" mapto="instantRecord" flags="b" />
 		</device>
 	</map>
 
@@ -129,6 +146,10 @@
 	</map>
 	
 	<map context="InfobarChannelSelection">
+		<device name="compatible: pcKeyboard">
+			<key id="KEY_PREVIOUSSONG" mapto="historyBack" flags="mr" />
+			<key id="KEY_NEXTSONG" mapto="historyNext" flags="mr" />
+		</device>
 		<key id="KEY_LEFT" mapto="zapUp" flags="mr" />
 		<key id="KEY_RIGHT" mapto="zapDown" flags="mr" />
 		<key id="KEY_UP" mapto="switchChannelUp" flags="mr" />
@@ -139,8 +160,8 @@
 		<key id="KEY_FORWARD" mapto="historyNext" flags="mr" />
 		<key id="KEY_CHANNELUP" mapto="openServiceList" flags="m" />
 		<key id="KEY_CHANNELDOWN" mapto="openServiceList" flags="m" />
-		<key id="BTN_0" mapto="zapUp" flags="mr" />
-		<key id="BTN_1" mapto="zapDown" flags="mr" />
+		<key id="BTN_0" mapto="zapUp" flags="m" />
+		<key id="BTN_1" mapto="zapDown" flags="m" />
 	</map>
 	
 	<map context="MinuteInputActions">
@@ -170,6 +191,7 @@
 		<device name="compatible: pcKeyboard">
 			<key id="KEY_DELETE" mapto="deleteForward" flags="mr" />
 			<key id="KEY_BACKSPACE" mapto="deleteBackward" flags="mr" />
+			<key id="KEY_ENTER" mapto="ok" flags="m" />
 		</device>
 		<device name="dreambox remote control (native)">
 			<key id="KEY_MUTE" mapto="deleteForward" flags="mr" />
@@ -210,14 +232,14 @@
 	<map context="InfobarMenuActions">
 		<key id="KEY_MENU" mapto="mainMenu" flags="mr" />
 		<device name="compatible: pcKeyboard">
-			<key id="KEY_SPACE" mapto="mainMenu" flags="mr" />
+			<key id="KEY_F6" mapto="mainMenu" flags="mr" />
 		</device>
 	</map>
 	
 	<map context="MenuActions">
 		<key id="KEY_MENU" mapto="menu" flags="mr" />
 		<device name="compatible: pcKeyboard">
-			<key id="KEY_SPACE" mapto="menu" flags="mr" />
+			<key id="KEY_F6" mapto="menu" flags="mr" />
 		</device>
 	</map>
 	
@@ -232,6 +254,8 @@
 	<map context="InfobarActions">
 		<device name="compatible: pcKeyboard; dreambox ir keyboard">
 			<key id="KEY_F8" mapto="showMovies" flags="m" />
+			<key id="KEY_F9" mapto="showTv" flags="m" />
+			<key id="KEY_F10" mapto="showRadio" flags="m" />
 		</device>
 		<key id="KEY_VIDEO" mapto="showMovies" flags="m" />
 		<key id="KEY_RADIO" mapto="showRadio" flags="m" />
@@ -240,7 +264,7 @@
 
 	<map context="InfobarAudioSelectionActions">
 		<device name="compatible: pcKeyboard">
-			<key id="KEY_F3" mapto="audioSelection" flags="b" />
+			<key id="KEY_F7" mapto="audioSelection" flags="m" />
 		</device>
 		<device name="dreambox remote control (native)">
 			<key id="KEY_AUDIO" mapto="audioSelection" flags="m" />
@@ -254,10 +278,16 @@
 	</map>
 
 	<map context="InfobarSubserviceSelectionActions">
+		<device name="compatible: pcKeyboard">
+			<key id="KEY_F2" mapto="subserviceSelection" flags="b" />
+		</device>
 		<key id="KEY_GREEN" mapto="subserviceSelection" flags="b" />
 	</map>
 
 	<map context="InfobarSubserviceQuickzapActions">
+		<device name="compatible: pcKeyboard">
+			<key id="KEY_ESC" mapto="exit" flags="m" />
+		</device>
 		<key id="KEY_PREVIOUS" mapto="prevSubservice" flags="m" />
 		<key id="KEY_NEXT" mapto="nextSubservice" flags="m" />
 		<key id="KEY_BACK" mapto="prevSubservice" flags="m" />
@@ -276,6 +306,8 @@
 		<key id="KEY_VOLUMEUP" mapto="volumeUp" flags="mr" />
 		<key id="KEY_VOLUMEDOWN" mapto="volumeDown" flags="mr" />
 		<key id="KEY_MUTE" mapto="volumeMute" flags="mr" />
+		<key id="KEY_ESC" mapto="Stop" flags="l" />
+		<key id="KEY_F1" mapto="displayHelp" flags="l" />
 		<key id="KEY_POWER" mapto="power_long" flags="l" />
 		<key id="KEY_POWER" mapto="power_down" flags="m" />
 		<key id="KEY_POWER" mapto="power_up" flags="b" />
@@ -337,6 +369,13 @@
 			<key id="KEY_F4" mapto="seekFwd" flags="b" />
 			<key id="KEY_F1" mapto="seekBackManual" flags="l" />
 			<key id="KEY_F4" mapto="seekFwdManual" flags="l" />
+			<key id="KEY_PLAYPAUSE" mapto="pauseService" flags="b" />
+			<key id="KEY_PLAYPAUSE" mapto="unpauseService" flags="l" />
+			<key id="KEY_PREVIOUSSONG" mapto="seekBack" flags="b" />
+			<key id="KEY_NEXTSONG" mapto="seekFwd" flags="b" />
+			<key id="KEY_PREVIOUSSONG" mapto="seekBackManual" flags="l" />
+			<key id="KEY_NEXTSONG" mapto="seekFwdManual" flags="l" />
+			<key id="KEY_ENTER" mapto="unPauseService" flags="m" />
 		</device>
 		<device name="dreambox remote control (native)">
 			<key id="KEY_YELLOW" mapto="pauseService" flags="b" />
@@ -381,6 +420,12 @@
 			<key id="KEY_F4" mapto="seekFwd" flags="b" />
 			<key id="KEY_F1" mapto="seekBackManual" flags="l" />
 			<key id="KEY_F4" mapto="seekFwdManual" flags="l" />
+			<key id="KEY_LEFT" mapto="seekBack" flags="m" />
+			<key id="KEY_RIGHT" mapto="seekFwd" flags="m" />
+			<key id="KEY_PREVIOUSSONG" mapto="seekBack" flags="b" />
+			<key id="KEY_NEXTSONG" mapto="seekFwd" flags="b" />
+			<key id="KEY_PREVIOUSSONG" mapto="seekBackManual" flags="l" />
+			<key id="KEY_NEXTSONG" mapto="seekFwdManual" flags="l" />
 		</device>
 		<device name="dreambox remote control (native)">
 			<key id="KEY_RED" mapto="seekBack" flags="b" />
@@ -411,11 +456,15 @@
 
 	<map context="InfobarTimeshiftActions">
 		<device name="compatible: pcKeyboard">
-			<key id="KEY_F3" mapto="timeshiftStart" flags="b" />
+			<key id="KEY_PLAYPAUSE" mapto="timeshiftStart" flags="b" />
+			<key id="KEY_ESC" mapto="timeshiftStop" flags="l" />
+			<key id="KEY_TV" mapto="timeshiftStop" flags="m" />
+			<key id="KEY_RADIO" mapto="timeshiftStop" flags="m" />
 		</device>
 		<device name="dreambox advanced remote control (native)">
 			<key id="KEY_PLAY" mapto="timeshiftStart" flags="m" />
 			<key id="KEY_TV" mapto="timeshiftStop" flags="m" />
+			<key id="KEY_RADIO" mapto="timeshiftStop" flags="m" />
 			<key id="KEY_STOP" mapto="timeshiftStop" flags="m" />
 		</device>
 		<device name="dreambox remote control (native)">
@@ -432,8 +481,8 @@
 
 	<map context="InfobarTimeshiftActivateActions">
 		<device name="compatible: pcKeyboard">
-			<key id="KEY_F1" mapto="timeshiftActivateEnd" flags="b" />
-			<key id="KEY_F3" mapto="timeshiftActivateEndAndPause" flags="b" />
+			<key id="KEY_F11" mapto="timeshiftActivateEnd" flags="b" />
+			<key id="KEY_F6" mapto="timeshiftActivateEndAndPause" flags="b" />
 		</device>
 		<device name="dreambox remote control (native)">
 			<key id="KEY_RED" mapto="timeshiftActivateEnd" flags="b" />
@@ -451,7 +500,8 @@
 
 	<map context="MovieSelectionActions">
 		<device name="compatible: pcKeyboard">
-			<key id="KEY_SPACE" mapto="contextMenu" flags="m" />
+			<key id="KEY_F6" mapto="contextMenu" flags="m" />
+			<key id="KEY_F5" mapto="showEventInfo" flags="m" />
 		</device>
 		<key id="KEY_MENU" mapto="contextMenu" flags="m" />
 		<key id="KEY_INFO" mapto="showEventInfo" flags="m" />
@@ -467,6 +517,9 @@
 	</map>
 
 	<map context="MoviePlayerActions">
+		<device name="compatible: pcKeyboard">
+			<key id="KEY_ESC" mapto="leavePlayer" flags="l" />
+		</device>
 		<device name="dreambox remote control (native)">
 			<key id="KEY_TV" mapto="leavePlayer" flags="m" />
 		</device>
@@ -524,17 +577,30 @@
 	
 	<map context="InfobarTeletextActions">
 		<key id="KEY_TEXT" mapto="startTeletext" flags="m" />
+		<device name="compatible: pcKeyboard">
+			<key id="KEY_F11" mapto="startTeletext" flags="b" />
+		</device>
 	</map>
 
 	<map context="InfobarHbbtvActions">
 		<key id="KEY_RED" mapto="hbbtvAutostart" flags="m" />
+		<device name="compatible: pcKeyboard">
+			<key id="KEY_F1" mapto="hbbtvAutostart" flags="b" />
+		</device>
 	</map>
 
 	<map context="InfobarRdsActions">
+		<device name="compatible: pcKeyboard">
+			<key id="KEY_F11" mapto="startRassInteractive" flags="m" />
+		</device>
 		<key id="KEY_TEXT" mapto="startRassInteractive" flags="m" />
 	</map>
 
 	<map context="RassInteractiveActions">
+		<device name="compatible: pcKeyboard">
+			<key id="KEY_F11" mapto="startRassInteractive" flags="m" />
+			<key id="KEY_ESC" mapto="exit" flags="m" />
+		</device>
 		<key id="KEY_LEFT" mapto="prevSubPage" flags="mr" />
 		<key id="KEY_RIGHT" mapto="nextSubPage" flags="mr" />
 		<key id="KEY_UP" mapto="prevPage" flags="mr" />
@@ -691,6 +757,9 @@
 	</map>
 	
 	<map context="HelpActions">
+		<device name="compatible: pcKeyboard">
+			<key id="KEY_F1" mapto="displayHelp" flags="l" />
+		</device>
 		<key id="KEY_HELP" mapto="displayHelp" flags="m" />
 	</map>
 
@@ -707,6 +776,9 @@
 		<key id="KEY_BLUE" mapto="blue" flags="mr" />
 	</map>
 	<map context="StandbyActions">
+		<device name="compatible: pcKeyboard">
+			<key id="KEY_SLEEP" mapto="power" flags="mr" />
+		</device>
 		<key id="KEY_POWER" mapto="power" flags="m" />
 		<!-- the followong entries are only used with non vendor ir rc 
 		     like harmony for discrete power on/off -->
@@ -797,11 +869,18 @@
 			<key id="KEY_NEXTSONG" mapto="next" flags="m" />
 		</device>
 		<device name="compatible: pcKeyboard">
-			<key id="KEY_SPACE" mapto="menu" flags="m" />
-			<key id="KEY_F1" mapto="previous" flags="m" />
+			<key id="KEY_ESC" mapto="stop" flags="l" />
+			<key id="KEY_X" mapto="stop" flags="b" />
+			<key id="KEY_F6" mapto="menu" flags="m" />
+			<key id="KEY_F1" mapto="previous" flags="b" />
+			<key id="KEY_PREVIOUSSONG" mapto="previous" flags="m" />
 			<key id="KEY_F2" mapto="play" flags="m" />
+			<key id="KEY_PLAYPAUSE" mapto="play" flags="m" />
 			<key id="KEY_F3" mapto="pause" flags="m" />
 			<key id="KEY_F4" mapto="next" flags="m" />
+			<key id="KEY_NEXTSONG" mapto="next" flags="m" />
+			<key id="KEY_F8" mapto="delete" flags="l" />
+			<key id="KEY_F11" mapto="subtitles" flags="l" />
 		</device>
 		<key id="KEY_MENU" mapto="menu" flags="m" />
 		<key id="KEY_2" mapto="skipListbegin" flags="m" />
-- 
2.1.4

